		.ORIG x4FC5
MAIN		LDI R1,LBOUND
		LDI R2,RBOUND
		ADD R0,R1,#0
		ST R6, SVR6
		LD R6, FUNCADDR     
		JSRR R6    ;  FUNC(L) --> R5  STORE VAL ,AVOID RECALCULATING
		LD R6,SVR6
		ADD R5,R4,#0  ;

	L0	NOT R3,R1
		ADD R3,R3,R2 ;R2-R1-1  --> R3
		BRnz STVAL
		JSR TWODIV
		ST R6, SVR6
		LD R6, FUNCADDR
		JSRR R6
		LD R6, SVR6
		AND R4,R4,R4
		BRz STVAL
		BRn  L1
		ADD R5,R5,#0
		BRn  L2
		ADD R1,R0,#0
	L1	ADD R5,R5,#0   
		BRn  L3 
	L2	ADD R2,R0,#0
		NOT R4,R4    ;st left-end 's  funcval (symbol)
		ADD R4,R4,#1
		BRnzp L4
	L3	ADD R1,R0,#0
	L4	ADD R5,R4,#0
		BRnzp L0
		
	STVAL	LD R3,RST
		STR R0,R3,#0
		HALT



TWODIV		;(R1+R2)/2  --> R0
		ST R1,SVR1
		ST R2,SVR2
		ADD R1,R1,#-1
		ADD R2,R2,#1
	TDLAB	ADD R1,R1,#1
		ADD R2,R2,#-1
		NOT R0,R1
		ADD R0,R0,R2  ;R2-R1-1  --> R0
		BRp  TDLAB
		ADD R0,R2,#0  
		LD R1,SVR1
		LD R2,SVR2
		RET



SVR0		.FILL 0
SVR1		.FILL 0		
SVR2		.FILL 0	
SVR3		.FILL 0	
SVR5		.FILL 0
SVR6		.FILL 0	
N		.FILL x4003
DATA		.FILL x4004
RBOUND		.FILL x4002
LBOUND		.FILL x4001
RST		.FILL x4000
FUNCADDR	.FILL x5000


FUN		;FUNC(R0)--> R4
		ST R1 ,SVR1
		ST R2 ,SVR2
		ST R3 ,SVR3
		AND R4,R4,#0  ;initial  xlear
		LD R2,DATA
		LDI R1,N
	LOOP	LDR R3,R2,#0
		ADD R2,R2,#1
		ADD R4,R3,R4
		ADD R1,R1,#-1
		BRn  FUNCEND

MUL		;MUL R4,R0,R4
		ST R0,SVR0 
		ST R5,SVR5
		ADD R5,R4,#0
		AND R3,R3,#0 ; MARK IF RO=1,R1=1 ELSE 0 
		ADD R0,R0,#0
		BRz  ZERO
		BRp MULLAB0
		ADD R3,R3,#1
		NOT R0,R0
		ADD R0,R0,#1
	MULLAB0	ADD R0,R0,#-1
	MULLAB1	BRz  MULLAB2
		ADD R4,R4,R5
		BRnzp MULLAB0
	ZERO	AND R4,R4,#0
	MULLAB2	ADD R3,R3,#0
		BRz  POS
		NOT R4,R4
		ADD R4,R4,#1
	POS	LD R0, SVR0
		LD R5, SVR5
		BRnzp LOOP

	FUNCEND	LD R1,SVR1
		LD R2,SVR2
		LD R3,SVR3
		RET

		.END